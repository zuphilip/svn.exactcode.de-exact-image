#!/usr/bin/env bash

. config/functions

with_options="x11 evas libjpeg libtiff libpng libungif jasper openexr lcms bardecode swig perl"
feature_options="evasgl"

PACKAGE="exact-image"
VERSION_MAJOR=0
VERSION_MINOR=3
VERSION_MICRO=8

init

prefix="/usr/local"

parse_options $*

compile c++ available.c || status_error \
	"A C++ compiler is not installed or does not work correctly.
A C++ compiler is vital for exact-image - so you need to install it first."

compile c++ stl.c template.c template-specialization.c \
        partial-template-specialization.c function-template.c \
        || status_error \
	"At least one of the advanced ANSI C++ tests failed. Since these
features are vital for exact-image you need to update to a more recent compiler first."

headercheck c++ iostream string iostream sstream fstream || \
	status_error "Not all tested STL headers are present - please install them."

pkgcheck x11 compile X11 atleast 11.0
if ! pkgcheck evas pkg-config EVAS atleast 0.9.9; then
	cat <<-EOT

		Enlightenment Evas was not found - edisplay is disabled.
		Evas can be obtained from: www.enlightenment.org

EOT
fi

if headercheck "cc $EVASINCS " "Evas_Engine_GL_X11.h"
then EVASGL=1
else EVASGL=0
fi

pkgcheck libjpeg header LIBJPEG cc jconfig.h
pkgcheck libtiff header LIBTIFF c++ tiff.h
pkgcheck libpng pkg-config LIBPNG atleast 1.2
pkgcheck libungif header LIBUNGIF c++ gif_lib.h
pkgcheck jasper header JASPER c++ jasper/jasper.h
pkgcheck OpenEXR pkg-config OPENEXR atleast 1.2.0
pkgcheck lcms pkg-config LCMS atleast 1.10

# this is PROPERITARY SOFTWARE - only use this if you have to ...
if pkgcheck bardecode shell BARDECODE \
    '[ -e external/bardecode.a -a -e external/barcode.h ] && echo yes'; then
    var_append BARDECODEINCS " " "-I external"
    var_append BARDECODELIBS " " "external/bardecode.a"
else
	cat <<-EOT

		For barcode recognition, please place the commercial library
		from http://www.bardecode.com/ into the external/ directory.

EOT
fi

pkgcheck swig shell SWIG 'swig -version 2>/dev/null | sed -n "s/SWIG Version \(.*\)/\1/p"' atleast 1.3.0

# supported swig target languages so far

pkgcheck perl shell PERL 'perl -version 2>/dev/null | sed -n "s/This is perl, v\(.*\) built.*/\1/p"' atleast 5.8.0 &&
	PERLINCS=`perl -MExtUtils::Embed -e ccopts`

save
